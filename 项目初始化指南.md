# xDrip iOS 项目初始化指南

## 项目概述

xDrip4iOS 是一个开源的血糖监测应用，支持多种血糖传感器和发射器，包括：
- Dexcom G4/G5/G6
- MiaoMiao 1/2
- Blucon
- Bubble
- Libre 2
- 等等

## 项目结构

```
xdripios/
├── xDrip/                          # 主应用代码
├── xDrip Watch App/                # Apple Watch 应用
├── xDrip Widget/                   # iOS 小组件
├── xDrip Notification Context Extension/  # 通知扩展
├── xDrip Watch Complication/       # 表盘复杂功能
├── Frameworks/                     # 自定义框架
│   ├── BleLibrary.framework/       # 蓝牙库
│   └── FotaLibrary.framework/      # 固件更新库
├── RSL_Fota/                       # 固件更新相关代码
└── Fota/                          # 固件文件
```

## 环境要求

- **Xcode**: 15.0 或更高版本
- **iOS 部署目标**: iOS 14.0+
- **Swift**: 5.0+
- **Ruby**: 2.6+ (用于 Fastlane)

## 初始化步骤

### 1. 使用批处理文件（推荐）

在 Windows 系统上运行：
```cmd
setup_environment.bat
```

### 2. 手动初始化

#### 2.1 安装 Ruby 依赖
```bash
# 安装指定版本的 Bundler
gem install bundler:2.4.19

# 安装项目依赖
bundle install
```

#### 2.2 解析 Swift Package Manager 依赖
```bash
xcodebuild -workspace xdrip.xcworkspace -scheme xdrip -resolvePackageDependencies
```

#### 2.3 验证项目配置
```bash
xcodebuild -workspace xdrip.xcworkspace -scheme xdrip -configuration Debug -showBuildSettings
```

## 项目配置

### 版本信息
- **营销版本**: 5.6.2
- **构建版本**: 4212
- **开发团队**: 7RV2Y67HF6

### Bundle ID
- **主应用**: com.7RV2Y67HF6.xdripswift
- **App Group**: group.com.7RV2Y67HF6.loopkit.LoopGroup

### 依赖库
项目使用以下 Swift Package Manager 依赖：
- **ActionClosurable**: 2.1.0
- **SnapKit**: 5.7.1
- **PieCharts**: master
- **CryptoSwift**: 1.9.0
- **SwiftCharts**: master

## 构建方案

项目包含以下构建方案：
1. **xdrip** - 主应用
2. **BleLibrary** - 蓝牙库
3. **FotaLibrary** - 固件更新库
4. **xDrip Watch App** - Apple Watch 应用
5. **xDrip Widget Extension** - iOS 小组件
6. **xDrip Notification Context Extension** - 通知扩展
7. **xDrip Watch Complication Extension** - 表盘复杂功能

## 构建命令

### 构建主应用
```bash
xcodebuild -workspace xdrip.xcworkspace -scheme xdrip -configuration Debug -destination "platform=iOS Simulator,name=iPhone 15 Pro" build
```

### 构建所有目标
```bash
xcodebuild -workspace xdrip.xcworkspace -scheme xdrip -configuration Debug build
```

### 清理项目
```bash
xcodebuild -workspace xdrip.xcworkspace -scheme xdrip clean
```

## 开发注意事项

1. **代码签名**: 项目使用自动代码签名，确保在 Xcode 中正确配置开发团队
2. **权限**: 应用需要蓝牙、健康数据、通知等权限
3. **测试**: 建议在真机上测试蓝牙功能
4. **调试**: 使用 Xcode 的调试工具来监控血糖数据流

## 故障排除

### 常见问题

1. **包依赖解析失败**
   ```bash
   xcodebuild -workspace xdrip.xcworkspace -scheme xdrip -resolvePackageDependencies
   ```

2. **代码签名问题**
   - 检查 Xcode 中的开发团队设置
   - 确保 Bundle ID 唯一

3. **构建失败**
   - 清理项目: `xcodebuild clean`
   - 删除 DerivedData
   - 重新解析依赖

## 相关资源

- [项目文档](https://xdrip4ios.readthedocs.io/en/latest/)
- [GitHub Wiki](https://github.com/JohanDegraeve/xdripswift/wiki)
- [联系邮箱](mailto:xdrip@proximus.be)

## 许可证

请查看项目根目录的 LICENSE 文件了解详细信息。
