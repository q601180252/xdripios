# 证书数量已达限制 - 解决方案

## 问题说明

您的 Apple Developer 账号已经有 2 个 Distribution 证书(这是 Apple 的最大限制)。

```
Could not create another Distribution certificate
Reached the maximum number of available Distribution certificates
```

**Apple 限制**: 每个账号最多只能有 2 个 Distribution 证书。

---

## 🎯 解决方案

有两个选择:

### 方案 1: 删除一个旧证书 (推荐)

如果您有不再使用的旧证书,可以删除它:

1. 访问 Apple Developer Portal:
   https://developer.apple.com/account/resources/certificates/list

2. 找到 **Distribution** 类型的证书

3. 选择一个不再使用的证书,点击 "Revoke"

4. 重新运行 GitHub Actions workflow

**注意**: 删除证书后,使用该证书签名的应用将无法更新,除非重新签名。

---

### 方案 2: 使用现有证书 (需要手动操作)

#### 步骤 1: 从 Keychain 导出证书

1. 打开 **Keychain Access** (钥匙串访问)

2. 在 "登录" 钥匙串中找到您的 **Distribution** 证书
   - 名称通常类似: "Apple Distribution: Your Name (TEAMID)"

3. 右键点击证书,选择 "导出"

4. 保存为 `.p12` 文件,设置一个密码(记住这个密码!)

#### 步骤 2: 手动将证书导入 Match 仓库

在本地运行以下命令:

```bash
cd /Users/liyang/Documents/work/wunew/ios/loopcloud2/xdripios

# 设置环境变量
export MATCH_PASSWORD="您的Match密码"
export GH_PAT="您的GitHub_PAT"
export GITHUB_REPOSITORY_OWNER="q601180252"
export TEAMID="HHZN32E89C"

# 导入证书
bundle exec fastlane run match_import \
  certificate_path:"path/to/your/certificate.p12" \
  certificate_password:"您的p12密码" \
  type:"appstore" \
  git_url:"https://github.com/q601180252/xDrip-Match-Secrets.git" \
  git_basic_authorization:"$(echo -n "$GITHUB_REPOSITORY_OWNER:$GH_PAT" | base64)"
```

替换:
- `path/to/your/certificate.p12`: 您导出的证书路径
- `您的p12密码`: 导出证书时设置的密码
- `您的Match密码`: Match 仓库的密码

#### 步骤 3: 创建 Provisioning Profiles

证书导入后,运行:

```bash
bundle exec fastlane certs
```

这将使用导入的证书创建 5 个 Provisioning Profiles。

---

## ⚡ 快速方案 (推荐)

最简单的方法是删除一个不用的旧证书:

### 1. 检查现有证书

访问: https://developer.apple.com/account/resources/certificates/list

查看您的 2 个 Distribution 证书:
- 证书名称
- 创建日期  
- 过期日期

### 2. 删除旧证书

选择较旧的或不再使用的证书,点击 "Revoke"

### 3. 重新运行初始化

```bash
git push origin main
```

然后在 GitHub Actions 上重新运行:
https://github.com/q601180252/xdripios/actions

→ "Initialize Fastlane Match Repository"  
→ Run workflow

---

## 🔍 检查证书信息

在终端运行以下命令查看本地证书:

```bash
# 查看所有 Distribution 证书
security find-identity -v -p codesigning | grep "Apple Distribution"
```

---

## ❓ 常见问题

### Q: 删除证书会影响已发布的应用吗?

**A**: 不会。已经发布到 App Store 的应用不受影响。删除证书只影响:
- 新的构建
- 需要重新签名的应用

### Q: 我不确定哪个证书在使用?

**A**: 可以暂时删除较旧的证书。如果确实还在使用,您可以重新创建一个新的。

### Q: 能否扩容到 3 个证书?

**A**: 不能。这是 Apple 的硬性限制,无法扩容。

---

## 📋 推荐操作流程

**最简单的方案** (5 分钟):

1. ✅ 访问 https://developer.apple.com/account/resources/certificates/list

2. ✅ 删除一个不用的旧 Distribution 证书

3. ✅ 重新运行 GitHub Actions 初始化 workflow

就这么简单!

---

## 需要帮助?

如果您不确定要删除哪个证书,或者需要保留两个证书,请告诉我:
- 两个证书的名称和创建日期
- 它们分别用于哪些项目

我可以帮您分析并给出建议。

